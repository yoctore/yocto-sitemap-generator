/* yocto-sitemap-generator - Module that generate sitemap.xml - V0.1.0 */
"use strict";function Factory(a){this.logger=a}var logger=require("yocto-logger"),_=require("lodash"),Q=require("q"),xmlParser=require("xml2json"),async=require("async");Factory.prototype.remapSitemap=function(a,b,c){var d=Q.defer(),e=[];return a=_.isString(a)?JSON.parse(xmlParser.toJson(a)):a,async.each(a.urlset.url,function(a,d){this.buildUrl(a,b,c).then(function(a){e.push(a),d()}).catch(function(){d()})}.bind(this),function(){a.urlset.url=_.compact(e),d.resolve(a)}),d.promise},Factory.prototype.buildUrl=function(a,b,c){var d=Q.defer(),e={},f=_.replace(a.loc,c,"");return async.parallel([function(a){_.each(b.exclude,function(a){f.match(new RegExp(a))&&(e=null)}),a()},function(c){_.each(b.override,function(b){f.match(new RegExp(b.regex))&&(e=_.merge(a,b.params))}),c()}],function(){!_.isNull(e)&&_.isEmpty(e)&&(e=_.merge(a,b.default.params)),d.resolve(e)}),d.promise},module.exports=function(a){return(_.isUndefined(a)||_.isNull(a))&&(logger.warning("[ Factory.constructor ] - Invalid logger given. Use internal logger"),a=logger),new Factory(a)};